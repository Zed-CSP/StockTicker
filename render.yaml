databases:
  - name: stockticker-db
    plan: free
    databaseName: stockticker
    user: stockticker

services:
  - type: web
    name: stockticker-api
    env: docker
    dockerfilePath: apps/api/Dockerfile
    healthCheckPath: /health
    envVars:
      - key: PORT
        value: "4000"
      - key: DATABASE_URL
        fromDatabase:
          name: stockticker-db
          property: connectionString
      - key: ALPHAVANTAGE_API_KEY
        sync: false
      - key: TRACKED_SYMBOLS
        value: AAPL,MSFT,GOOGL,AMZN,NVDA,META,TSLA,JPM,V,MA,JNJ,PG,KO,PEP,XOM
      - key: AV_MIN_MS_BETWEEN_CALLS
        value: "12000"
      - key: OVERVIEW_TTL_DAYS
        value: "30"
      # Set this to your deployed web origin once created.
      - key: CORS_ORIGIN
        value: https://stockticker-web.onrender.com

  - type: web
    name: stockticker-web
    env: docker
    dockerfilePath: apps/web/Dockerfile
    envVars:
      # Next.js server route handlers proxy to this at runtime.
      - key: API_BASE_URL
        value: https://stockticker-api.onrender.com

  - type: cron
    name: stockticker-daily-refresh
    env: docker
    dockerfilePath: apps/api/Dockerfile.cron
    schedule: "0 6 * * *"
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: stockticker-db
          property: connectionString
      - key: ALPHAVANTAGE_API_KEY
        sync: false
      - key: TRACKED_SYMBOLS
        value: AAPL,MSFT,GOOGL,AMZN,NVDA,META,TSLA,JPM,V,MA,JNJ,PG,KO,PEP,XOM
      - key: AV_MIN_MS_BETWEEN_CALLS
        value: "12000"
      - key: OVERVIEW_TTL_DAYS
        value: "30"


